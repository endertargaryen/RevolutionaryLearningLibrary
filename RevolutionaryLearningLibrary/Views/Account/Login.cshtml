@{ ViewBag.Title = "Log In"; }

<script>
	app.controller('loginController', function ($scope, $http)
	{
		// data
		$scope.title = "Log in";
		$scope.email = "";
		$scope.password = "";
		$scope.error = false;
		$scope.errorMessage = "Invalid Email or Password";

		// functions
		$scope.validateLogin = function (email, password)
		{
			var parameters = JSON.stringify({
				Email: email,
				Password: password
			});

			$http.post('@ViewBag.LoginUrl', parameters).
				then(function success(data)
				{
					if(data.data.StatusCode !== StatusCode.OK)
					{
						$scope.error = true;
						$scope.errorMessage = "Error From Server: " + data.data.StatusCode.toString();
					}
					else
					{
						$scope.error = false;

						if ('@ViewBag.ReturnUrl' != '')
						{
							window.location = '@ViewBag.ReturnUrl';
						}
						else
						{
							window.location = '@ViewBag.RedirectUrl';
						}
					}
				},
				function error(data)
				{
					alert(data.data);
				});
		};

	});
</script>

<div ng-app="rev" ng-controller="loginController">
	<h2>{{title}}</h2>
	<div class="row">
		<div class="col-md-8">
			<section id="loginForm">
				<div class="form-group">
					<label class="col-md-2 control-label">Email</label>
					<input type="text" class="form-control" ng-model="email" />
				</div>
				<div class="form-group">
					<label class="col-md-2 control-label">Password</label>
					<input type="password" class="form-control" ng-model="password" />
				</div>
				<error ng-attr-error-message="errorMessage" ng-attr-has-error="error"></error>
				<div class="form-group">
					<div class="col-md-offset-2 col-md-10">
						<button ng-click="validateLogin(email, password)" type="button" class="btn btn-default">Log In</button>
					</div>
				</div>
			</section>
		</div>
	</div>
</div>
